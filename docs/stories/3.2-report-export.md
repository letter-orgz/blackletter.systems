id: 3.2
epic: 3
title: Report Export (PDF/HTML)
status: draft
story: |
  **As a** reviewer,
  **I want** to export the findings for a contract analysis into a PDF or HTML report,
  **so that** I can share the results or archive them.
acceptance_criteria:
  - PDF/HTML export with headings, verdicts, snippets, timestamps
  - Include file metadata (name, checksum) and analysis details
  - Asset is reproducible and deterministic from stored artefacts
  - Support for custom options (include logo, metadata, date format)
interfaces:
  - **API**: `POST /api/reports/{analysis_id}` returns `{ report_id, url }`
  - **Service**: `reports.py: generate_report(analysis_id, format, options) -> Report`
tasks: |
  - [ ] **Backend Implementation**
    - [ ] Create `POST /api/reports/{analysis_id}` endpoint
    - [ ] Implement report generation service with Jinja2 templates
    - [ ] Add headless Chromium PDF conversion using Playwright
    - [ ] Persist reports under `.data/analyses/{id}/reports/`
  - [ ] **Frontend Implementation**
    - [ ] Add export button to findings page header
    - [ ] Create export options dialog (format, logo, metadata)
    - [ ] Implement download functionality
  - [ ] **Testing**
    - [ ] Unit tests for report generation
    - [ ] Integration tests for PDF/HTML output
    - [ ] UI tests for export dialog and download
dev_agent_record:
  proposed_tasks:
    - backend: POST /api/reports/{analysis_id} PDF/HTML
    - render: Deterministic HTML from artefacts; headless Chromium to PDF
    - ui: Export button + options dialog; /reports list
    - tests: Golden output + error handling
  dependencies:
    - story: 3.1-findings-table
  impl_notes:
    - Added placeholder Export dialog in Findings header (apps/web) to validate copy and options flow
    - Dialog exposes include logo/metadata and date format; currently logs options without backend call

### dev_spec

- API: `POST /api/reports/{analysis_id}` body `{ format: 'html'|'pdf', include_logo?, include_metadata?, date_format? }` → 201 `{ report_id, url }`.
- Renderer: Jinja2 template from `analysis.json` + `findings.json` → deterministic HTML; convert to PDF with Playwright; persist under `.data/analyses/{id}/reports/`.
- UI: ExportDialog calls API; `/reports` lists generated reports; opens downloaded asset.

### qa_tests

- Golden HTML snapshot deterministic; includes headings, verdicts, snippets, timestamps, metadata.
- PDF non-empty and loadable; API error handling for missing artifacts.
- UI flow: dialog submit calls API and list updates.

### artifacts

- Files: `routers/reports.py`, `services/reports.py`, `web/components/ExportDialog.tsx`, `web/app/reports/page.tsx`, report templates under `templates/`
