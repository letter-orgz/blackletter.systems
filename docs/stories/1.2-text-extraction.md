id: 1.2
epic: 1
title: Text Extraction (PDF/DOCX)
status: draft
story: |
  As a system, I need to extract text, create a page map, and build a sentence index from uploaded PDF/DOCX files so that the detection engine can analyze the content.
acceptance_criteria:
  - Extract text → page map (page→char range) + sentence index
  - Store extraction artefacts linked to analysis record
  - Malformed/corrupt docs handled with explicit error codes
  - OCR default off; config flag enables OCR path
notes:
  - Use PyMuPDF for PDF, docx2python for DOCX as per tech stack.
  - Sentence splitting using blingfire.
  - Handle errors gracefully during extraction and persist error state.
tasks: []
dev_agent_record: {}

### dev_spec

- Services: `extract_pdf` (PyMuPDF), `extract_docx` (docx2python); `build_sentence_index` (blingfire) with deterministic splitting.
- Artifacts: `.data/analyses/{id}/extraction.json` containing pages [{page,text,char_start,char_end}] and sentences [{page,start,end,text}], plus checksum.
- Config: OCR off by default; gated by Org Settings flag; surface explicit error codes on malformed docs.
- Integration: Called from upload job pipeline after file persisted.

### qa_tests

- PDF/DOCX happy paths: non-empty pages; contiguous char ranges; sentences present.
- Error handling: corrupt inputs produce explicit error and set analysis error state.
- Config: OCR off path bypasses OCR; when enabled (stub), OCR branch invoked.
