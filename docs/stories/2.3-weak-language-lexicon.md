id: 2.3
epic: 2
title: Weak‑Language Lexicon v0
status: review
story: |
  As a detection system, I need to apply a lexicon of weak language terms to findings to potentially downgrade a 'Pass' verdict to 'Weak' if no strong counter-anchors are found.
acceptance_criteria:
  - Apply lexicon inside evidence window
  - Downgrade Pass→Weak unless counter‑anchor present
  - Configurable lexicon file
notes:
  - Depends on the Detector Runner (Story 2.2) producing initial verdicts.
  - Lexicon file format needs to be defined (likely YAML).
  - Counter-anchor logic needs definition.
  - This is a post-processing step for findings.
tasks: |
  - [x] backend: Load lexicon file and expose matcher API
  - [x] backend: Post-process findings to downgrade to Weak unless counter-anchors present
  - [x] config: Lexicon path in RULES_PATH; feature toggle
  - [x] tests: Lexicon matches; downgrade behavior; counter-anchor overrides
dev_agent_record:
  proposed_tasks:
    - backend: Load lexicon file and expose matcher API
    - backend: Post-process findings to downgrade to Weak unless counter-anchors present
    - config: Lexicon path in RULES_PATH; feature toggle
    - tests: Lexicon matches; downgrade behavior; counter-anchor overrides
  dependencies:
    - story: 2.2-detector-runner
  open_decisions:
    - Phrase normalization (stemming/lowercase) and window boundary handling
  agent_model: "GPT-4o"
  debug_log_references: "Story 2.3 implementation completed"
  completion_notes: |
    - Added support for counter-anchors in lexicon loading
    - Updated base weak language lexicon with counter-anchor terms
    - Implemented unit test for counter-anchor parsing
  file_list: |
    - apps/api/blackletter_api/services/lexicon_analyzer.py
    - apps/api/blackletter_api/rules/lexicons/weak_language.yaml
    - apps/api/blackletter_api/tests/unit/test_weak_language_detector.py
  change_log: |
    - Added counter-anchor support to lexicon loader
    - Added counter-anchors to default lexicon
    - Added test for counter-anchor loading

### dev_spec

- Loader: lexicon file `rules/lexicons/weak_language.yaml` with `terms`.
- Processor: `services/weak_lexicon.py apply_downgrade(findings, windows, counter_anchors)` lowers Pass→Weak when weak terms match and no counter-anchors present.
- Config: `WEAK_LEXICON_ENABLED=true` default; normalization via lowercase; optional stemming.

### qa_tests

- Matches cause downgrade; counter-anchors prevent it.
- Normalization ensures case-insensitive matching; respects window boundaries.
- Toggle-off path leaves findings unchanged.
