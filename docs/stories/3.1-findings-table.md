id: 3.1
epic: 3
title: Findings Table (evidence‑first)
status: approved
story: |
  **As a** reviewer,
  **I want** to see a table of findings for an analyzed contract,
  **so that** I can quickly understand which GDPR Article 28 clauses might be missing or weak.
acceptance_criteria:
  - Page `/analyses/:id` fetches `GET /api/analyses/{id}` + `GET /api/analyses/{id}/findings`
  - Table shows Detector | Verdict chip | short rationale | action (drawer)
  - Filters: multi‑select by verdict; search across snippets
  - Drawer: shows snippet (monospace), highlighted anchors, rule id, page+offsets, copy button; **ESC** closes; focus trapped; ARIA labels on verdict chips
  - Contrast meets WCAG AA; color not sole signal (icons + labels)
interfaces:
  - **API**: `GET /api/analyses/{id}` returns analysis metadata; `GET /api/analyses/{id}/findings` returns finding list
  - **UI**: `/analyses/[id]` page with `FindingsTable`, `VerdictBadge`, `EvidenceDrawer` components
tasks: []
dev_agent_record:
  proposed_tasks:
    - api: Add GET /api/analyses/{id} and /findings endpoints
    - ui: Build Findings table with verdict filter + snippet search
    - ui: Evidence Drawer (snippet, rule id, offsets, copy)
    - a11y: Table semantics, aria labels on chips
    - tests: UI render tests with fixtures
  dependencies:
    - story: 2.2-detector-runner
  impl_notes:
    - Mock-driven UI scaffolding added under apps/web: table, drawer, verdict chips, empty-state text
    - Toggle mocks via NEXT_PUBLIC_USE_MOCKS=1; falls back to API stubs otherwise
    - Local-only 'Reviewed' badge toggle in drawer for UX validation

### dev_spec

- API: Consume `GET /api/analyses/{id}` and `/findings`; fallback to mocks when `NEXT_PUBLIC_USE_MOCKS=1`.
- UI: FindingsTable with verdict filter, snippet search, empty-state; EvidenceDrawer with rule id, offsets, copy button; VerdictChips with ARIA.
- A11y: Table semantics; keyboard-open/close drawer; ESC closes.

### qa_tests

- Render 8 rows and correct verdict chips; filter/search interactions.
- Drawer opens via keyboard/click; copy copies snippet; empty-state visible.
- A11y checks on table semantics and ESC behavior.
  status_notes:
    - Approved based on implemented UI in apps/web with mocks and passing a11y/unit tests.
    - API endpoints remain as a dependency and will be handled in corresponding backend stories.

### dev_spec

- API: Consume `GET /api/analyses/{id}` and `/findings`; fallback to mocks when `NEXT_PUBLIC_USE_MOCKS=1`.
- UI: FindingsTable with verdict filter, snippet search, empty-state; EvidenceDrawer with rule id, offsets, copy button; VerdictChips with ARIA.
- A11y: Table semantics; keyboard-open/close drawer; ESC closes.
- Dependencies: Story 2.2 (detector runner) for findings data

### qa_tests

- Render 8 rows and correct verdict chips; filter/search interactions.
- Drawer opens via keyboard/click; copy copies snippet; empty-state visible.
- A11y checks on table semantics and ESC behavior.
- Contract: API payloads match expected TypeScript interfaces.

### artifacts

- Files: `web/app/analyses/[id]/page.tsx`, `web/components/FindingsTable.tsx`, `web/components/EvidenceDrawer.tsx`, `web/components/VerdictBadge.tsx`, hooks in `web/lib/`
