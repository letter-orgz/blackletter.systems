id: 2.4
epic: 2
title: Token Ledger & Caps
status: draft
story: |
  As a system administrator, I need to track token usage for LLM interactions and enforce caps to control costs and prevent abuse.
acceptance_criteria:
  - Track tokens_per_doc; expose metric
  - Hard cap triggers needs_review; logged with reason
  - LLM provider off by default
notes:
  - Only applies if LLM features are enabled via settings (Story 5.1).
  - Ledger should be a simple data structure to track usage per analysis.
  - Integration point with the LLM gate (part of Story 2.2 or a related task).
  - Needs to be performant and thread-safe if concurrent processing occurs.
tasks: []
dev_agent_record: {}