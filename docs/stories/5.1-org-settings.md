id: 5.1
epic: 5
title: Organization Settings & User Management
status: ready_for_dev
story: |
  As an administrator of an organization, I want to manage my organization's settings, invite new users, and manage their roles, so that I can control access and tailor the application to my organization's needs.
acceptance_criteria:
  - An organization can be created, and the creator is assigned as the first Admin.
  - Admins can invite new users to their organization via email.
  - Invited users receive a notification and can join the organization.
  - Admins can assign roles (Admin, Reviewer) to users within their organization.
  - Admins can remove users from their organization.
  - Users who belong to multiple organizations can switch between them.
  - A basic organization settings page is available where admins can manage users.
  - Users can view a list of members in their current organization.
notes:
  - This story focuses on the core multi-tenancy and user management features. It depends on Story 5.2 (Minimal Auth & Roles) for the definition and enforcement of roles.
  - The organization switching mechanism should be clear and accessible in the UI.
  - For MVP, organization settings might just be user management. Other settings can be added later.
dev_agent_record:
  proposed_tasks:
    - backend: Database schema changes for `organizations`, `users`, `organization_members` (linking users to orgs with a role).
    - backend: API endpoints for inviting users (`POST /orgs/{orgId}/invites`), accepting invites, managing users (`GET /orgs/{orgId}/users`, `DELETE /orgs/{orgId}/users/{userId}`).
    - backend: API endpoint for switching organization (`POST /users/me/switch-org/{orgId}`).
    - frontend: Create an "Organization Settings" page accessible to Admins.
    - frontend: UI components for inviting users, listing users, changing roles, and removing users.
    - frontend: Implement an organization switcher in the main navigation or user menu.
    - tests: Unit and integration tests for all new API endpoints.
    - tests: E2E tests for inviting a user and switching organizations.
qa_tests:
  - Verify an admin can invite a new user.
  - Verify invited user can join the organization.
  - Verify admin can assign 'Admin' and 'Reviewer' roles.
  - Verify admin can remove a user from the organization.
  - Verify a user in multiple organizations can switch between them.
  - Verify a 'Reviewer' cannot access the organization settings page.
