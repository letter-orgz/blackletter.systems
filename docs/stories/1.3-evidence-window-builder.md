id: 1.3
epic: 1 - Ingestion & Extraction
title: Evidence Window Builder
status: draft
detectors:
  - A28_3_a_instructions
  - A28_3_b_confidentiality
  - A28_3_c_security
nfrs:
  - p95_window_ms: 50
acceptance_criteria:
  - Given extracted text and a char span, return window of Â±2 sentences around span; sentence count configurable per detector.
  - Window respects sentence boundaries and does not cross page_map boundaries.
  - Span outside text yields error { code:'span_out_of_range', message }.
  - Unit tests cover spans at start, middle, end; out-of-range; cross-page; empty text.
subtasks:
  - Backend: implement services/evidence.py with function build_window(text, span, sentence_index, page_map, sentences=2).
  - Backend: ensure configuration via detector metadata to override sentence count.
  - Backend: update detection pipeline to call builder before detector evaluation.
fixtures:
  positive:
    - name: span_middle
      text: "First sentence. Second sentence contains anchor. Third sentence."
      span: [25,31]
    - name: span_start
      text: "Anchor here. Next sentence. Third sentence."
      span: [0,6]
    - name: span_end
      text: "First. Second. Anchor end."
      span: [16,21]
  negative:
    - name: span_oob
      text: "Only one sentence."
      span: [50,60]
    - name: cross_page
      text: "Page1 end.\fPage2 start anchor."
      span: [15,25]
    - name: empty_text
      text: ""
      span: [0,1]
dependencies:
  - 1.2
