**ID**: 0.0
**Epic**: 3  Findings & Reports (Demo)
**Status**: **Approved**
**Goal**: Showcase the entire product flow (Dashboard ��' Findings ��' Export) using a seeded mock test contract, before any real data or backend is wired.

## Context

- UX routes used: `/dashboard`, `/analyses/:id`, `/reports`.
- Env gate: Set `NEXT_PUBLIC_USE_MOCKS=1` to enable deterministic UI mocks.
- No backend required: Uses seeded data (deterministic RNG) for findings, snippets, verdicts, and export preview.

## Acceptance Criteria

1. Dashboard shows a seeded item ACME_DPA_MOCK.pdf with verdict chips (Pass/Weak/Missing/Needs review). Clicking it navigates to `/analyses/mock-1`.
2. Findings page renders 8 detector rows (a�?"h) with:
   - Verdict chips, rationale, and search/filter.
   - Evidence Drawer with highlighted anchors, page + char offsets, copy-to-clipboard, and a client-side Mark reviewed badge.
3. Export dialog opens from Findings header and allows: include logo, include metadata, choose date format. Confirming logs the selection (no backend call yet).
4. Reports list (stub) shows a placeholder ACME_DPA_MOCK latest export item after an export is initiated (mock list only).
5. Accessibility: keyboard tab order works, ESC closes drawer/dialog, chips have ARIA labels, contrast meets AA.
6. Toggle: Unsetting `NEXT_PUBLIC_USE_MOCKS` makes the UI fall back to the API stubs without errors.

## Interfaces (no new APIs)

- None. Frontend-only demo behind `NEXT_PUBLIC_USE_MOCKS=1`.

## Tasks

### Frontend

- Dashboard
  - Ensure `/dashboard` lists the seeded ACME_DPA_MOCK.pdf item with verdict chips and navigates to `/analyses/mock-1`.
- Findings
  - Keep page at `/analyses/[id]` working with id=`mock-1`.
  - Evidence Drawer highlights detector-specific anchors; Mark reviewed toggles a local flag.
  - Export dialog appears in header; confirmation currently `console.log`s options.
- Reports (stub)
  - Add `/reports` page that reads a local mock store and shows a single latest export entry when an export is confirmed in the dialog.
- A11y
  - Verify ESC behavior (drawer & dialog), focus trap, ARIA labels on verdict chips, and visible focus rings.

### Docs

- Add a Demo mode note in `apps/web/README.md` (how to enable/disable, what�?Ts included).

## Test Plan

- Unit (TS)
  - Mock builders return 8 detectors with stable verdict mix.
  - Anchor highlighting function wraps only intended phrases.
- UI (manual or Playwright)
  - Keyboard access (TAB/SHIFT+TAB), ESC on drawer/dialog.
  - Filter by verdict and see empty-state row when filters exclude all.
  - Export dialog option changes reflect in logged payload.
- Non-functional
  - Demo renders < 2s on a baseline machine; interactions < 100ms.

## Artifacts (expected)

- apps/web/src/app/dashboard/page.tsx (mock list & navigate)
- apps/web/src/app/analyses/[id]/page.tsx (header with chips & Export button; table+drawer wiring)
- apps/web/src/components/FindingsTable.tsx (filters/search/empty-state)
- apps/web/src/components/EvidenceDrawer.tsx (anchor highlighting, copy, reviewed badge)
- apps/web/src/components/VerdictChips.tsx (summary chips)
- apps/web/src/components/ExportDialog.tsx (options)
- apps/web/src/lib/mocks.ts (seeded findings + summary)
- apps/web/src/lib/anchors.ts (detector ��' anchor terms)
- apps/web/.env.example (adds `NEXT_PUBLIC_USE_MOCKS=1`)

## Definition of Done

- All acceptance criteria demonstrated in a screen-recording: Dashboard ��' Findings ��' Export ��' Reports (stub).
- No backend running; `NEXT_PUBLIC_USE_MOCKS=1` drives the entire flow.
- A11y checks pass (ESC, focus, aria).
- Demo mode instructions are present in `apps/web/README.md`.

---

## dev_agent_record

**proposed_tasks**

- [x] Add `/reports` page that reads/writes to a client-side mock store (in-memory module or `sessionStorage`) and displays a single latest export row.
- [x] Wire `ExportDialog` confirm -> push a record into the mock store, then `router.push("/reports")`.
- [x] Add keyboard/focus tests (lightweight) for drawer & dialog; verify ARIA labels on verdict chips.
- [x] Update `apps/web/README.md` with Demo mode instructions (env flag, routes to try, limitations).

**agent_model_used**

- dev

**file_list**

- apps/web/src/app/analyses/[id]/page.tsx (wired export confirm to mock store + navigate)
- apps/web/src/app/reports/page.tsx (stub reports list backed by sessionStorage)
- apps/web/src/components/ExportDialog.tsx (ESC close, focus behavior)
- apps/web/src/components/VerdictChips.tsx (ARIA labels)
- apps/web/src/components/EvidenceDrawer.tsx (ESC close, copy, highlight)
- apps/web/src/components/FindingsTable.tsx (filters/search/empty state)
- apps/web/src/lib/mockStore.ts (sessionStorage-backed mock exports)
- apps/web/.env.example (added NEXT_PUBLIC_USE_MOCKS)
- apps/web/README.md (demo mode instructions)
 - apps/web/src/components/FindingsClient.tsx (client wrapper for table+drawer)
 - apps/web/src/components/ExportClient.tsx (client wrapper for export dialog + navigation)
 - apps/web/src/app/new/page.tsx (use Link for navigation)
 - apps/web/src/app/landing/page.tsx (replace require with hooks imports)
 - apps/web/src/components/FindingsTable.tsx (typed select change handler)
  - apps/web/test/components/ExportDialog.test.tsx (dialog ESC, focus, aria)
  - apps/web/test/components/EvidenceDrawer.test.tsx (drawer ESC, highlight, aria)
  - apps/web/test/components/FindingsTable.test.tsx (filter/search + empty-state)
  - apps/web/test/components/VerdictChips.test.tsx (chip aria labels)
  - apps/web/test/setup-jest.ts (RTL jest-dom setup)
  - apps/web/jest.config.js (Next.js Jest config)

**change_log**

- feat(web): add mock reports list and export wiring
- chore(web): add .env.example with NEXT_PUBLIC_USE_MOCKS
 - refactor(web): extract client components and remove require() usage
 - fix(web): replace anchor with Next Link in new upload flow
 - fix(web): type verdict select change; satisfy eslint
 - test(web): add RTL/Jest a11y tests for demo flow (dialog, drawer, table, chips)
 - fix(web): add aria-labelledby on dialog/drawer for accessible names

**completion_notes**

- Flow validated Dashboard -> Findings -> Export -> Reports using mocks.
 - A11y unit tests added and passing (Jest + RTL).
 - Lint: npm run lint now passes with 0 errors (2 warnings remain: unused directive in new/page.tsx and unused var in mocks.ts).

**debug_log**

- Ran: `npm run lint` in `apps/web` -> fixed errors by extracting client components and updating types/links.
 - Ran: `npm run test` in `apps/web` -> 4 suites, 5 tests passing.

**decisions**

- Demo remains frontend-only, strictly under `NEXT_PUBLIC_USE_MOCKS`, to keep scope independent of API work.
- No API schemas or contracts change in this story.
- Reports page is a stub; later story 3.2 will attach it to real exports.

**notes**

- This story is intentionally independent; it unblocks sales/demo and user feedback while backend lands.

### dev_spec

- Routes: `/dashboard`, `/analyses/mock-1`, `/reports`; gated by `NEXT_PUBLIC_USE_MOCKS=1`.
- Files: apps/web pages and components per Artifacts list; `mockStore` for session-backed export row.
- Behavior: seeded ACME_DPA_MOCK.pdf; 8 detector rows; Evidence Drawer; Export dialog logs options then navigates to `/reports`.
- A11y: ESC closes drawer/dialog; focus trap; ARIA labels on chips; visible focus.

### qa_tests

- E2E: dashboard → findings → export → reports shows latest (Playwright).
- Filters/Search: verdict filter and snippet search, empty-state when none.
- A11y: keyboard traversal; ESC on drawer/dialog; ARIA on chips.
- Toggle: with/without `NEXT_PUBLIC_USE_MOCKS` renders without errors.

