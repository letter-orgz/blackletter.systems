# Test Design: Story 2.1

Date: 2025-08-29
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 10
- Unit tests: 7 (70%)
- Integration tests: 2 (20%)
- E2E tests: 1 (10%)
- Priority distribution: P0: 6, P1: 3, P2: 1

## Test Scenarios by Acceptance Criteria

### AC1: Load YAML; validate schema; list detectors and lexicons

#### Scenarios

| ID              | Level       | Priority | Test                                                   | Justification                                  |
| --------------- | ----------- | -------- | ------------------------------------------------------ | ---------------------------------------------- |
| 2.1-UNIT-001    | Unit        | P0       | Validate loading valid YAML file                       | Core functionality, pure logic                 |
| 2.1-UNIT-002    | Unit        | P0       | Validate schema validation for valid rulepack          | Core functionality, pure logic                 |
| 2.1-UNIT-003    | Unit        | P0       | Validate schema validation rejects invalid YAML        | Core functionality, pure logic, error handling |
| 2.1-UNIT-004    | Unit        | P0       | Validate lexicon loading from `lexicons/` subdir       | Core functionality, pure logic                 |
| 2.1-UNIT-005    | Unit        | P1       | Validate listing of loaded detectors                   | Core functionality, pure logic                 |
| 2.1-UNIT-006    | Unit        | P1       | Validate listing of loaded lexicons                    | Core functionality, pure logic                 |
| 2.1-INT-001     | Integration | P0       | Validate successful loading of a complete rulepack     | Multi-component flow (loader + file system)    |
| 2.1-INT-002     | Integration | P1       | Validate API summary endpoint returns correct data     | API integration test                           |
| 2.1-E2E-001     | E2E         | P2       | User (admin) views rulepack summary via API            | Critical path validation (if API is used)      |

### AC2: On invalid YAML, surface clear errors

#### Scenarios

| ID              | Level       | Priority | Test                                                   | Justification                                  |
| --------------- | ----------- | -------- | ------------------------------------------------------ | ---------------------------------------------- |
| 2.1-UNIT-007    | Unit        | P0       | Validate clear error message for malformed YAML        | Core functionality, pure logic, error handling |
| 2.1-UNIT-008    | Unit        | P1       | Validate clear error message for missing required keys | Core functionality, pure logic, error handling |

### AC3: Config: rules path env var; hotâ€‘reload disabled in prod

#### Scenarios

| ID              | Level       | Priority | Test                                                   | Justification                                  |
| --------------- | ----------- | -------- | ------------------------------------------------------ | ---------------------------------------------- |
| 2.1-UNIT-009    | Unit        | P0       | Validate loading from path specified by env var        | Core configuration, pure logic                 |
| 2.1-INT-003     | Integration | P1       | Validate hot-reload is disabled in production env      | Configuration integration, critical behavior   |
| 2.1-INT-004     | Integration | P1       | Validate hot-reload works in non-production env (if enabled) | Configuration integration, developer experience |

## Risk Coverage

- TECH-001 (Schema Validation Rigidity): Covered by 2.1-UNIT-002, 2.1-UNIT-003, 2.1-UNIT-008
- DATA-001 (Lexicon Loading Failure): Covered by 2.1-UNIT-004 (Happy path), future tests can cover failure modes.
- OPS-001 (Hot-Reload in Non-Production): Covered by 2.1-INT-003, 2.1-INT-004
- MAINT-001 (Test Coverage Gap): Not directly a test design item, but the design ensures space for the missing test.

## Recommended Execution Order

1. P0 Unit tests (fail fast)
2. P0 Integration tests
3. P1 tests in order
4. P2+ as time permits

Test design matrix: qa.qaLocation/assessments/2.1-rulepack-loader-test-design-20250829.md
P0 tests identified: 6