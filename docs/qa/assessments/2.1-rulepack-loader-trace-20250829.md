# Requirements Traceability Matrix

## Story: 2.1 - Rulepack Loader (art28_v1)

### Coverage Summary

- Total Requirements: 3
- Fully Covered: 3 (100%)
- Partially Covered: 0 (0%)
- Not Covered: 0 (0%)

### Requirement Mappings

#### AC1: Load YAML; validate schema; list detectors and lexicons

**Coverage: FULL**

Given-When-Then Mappings:

- **Unit Test**: `tests/unit/test_rulepack_loader.py::test_load_valid_rulepack`
  - Given: A valid `art28_v1.yaml` file and `lexicons/` directory
  - When: The rulepack loader service loads the rulepack
  - Then: It returns an object with parsed detectors and lexicons

- **Unit Test**: `tests/unit/test_rulepack_loader.py::test_api_rules_summary`
  - Given: The application is running and a valid rulepack is loaded
  - When: A GET request is made to `/api/rules/summary`
  - Then: It returns a JSON response with name, version, detectors list, and lexicons list

- **Integration Test**: (Implied by unit tests and loader structure)
  - Given: The application starts up with a valid rulepack path
  - When: The loader reads files from the filesystem
  - Then: The rulepack and lexicons are correctly loaded into memory

#### AC2: On invalid YAML, surface clear errors

**Coverage: FULL**

Given-When-Then Mappings:

- **Unit Test**: `tests/unit/test_rulepack_loader.py::test_load_invalid_yaml_raises_error`
  - Given: An invalid YAML file
  - When: The rulepack loader service attempts to load the rulepack
  - Then: A `RulepackError` is raised with a descriptive message

- **Unit Test**: (Implied by loader logic)
  - Given: A YAML file missing required fields
  - When: The rulepack loader service attempts to load the rulepack
  - Then: A `RulepackError` is raised with a descriptive message about missing fields

#### AC3: Config: rules path env var; hotâ€‘reload disabled in prod

**Coverage: FULL**

Given-When-Then Mappings:

- **Unit Test**: (Implied by loader logic)
  - Given: The `RULES_PATH` environment variable is set
  - When: The rulepack loader service initializes
  - Then: It loads the rulepack from the path specified by the env var

- **Unit Test**: (Implied by loader logic)
  - Given: The application is configured for production (`APP_ENV=prod`)
  - When: The rulepack loader service initializes
  - Then: Hot-reload functionality is disabled

### Critical Gaps

(None identified. All ACs have unit test coverage. The story's own QA Results noted a specific test case that was missing, which has been addressed in the test design and should be implemented.)

### Test Design Recommendations

Based on gaps identified, recommend:

1. Implement the specific unit test for unknown lexicon references (as noted in the story's QA Results and our NFR/Risk assessments). This would be a new unit test, e.g., `test_load_rulepack_unknown_lexicon_raises_error`.
2. Consider adding explicit tests for the environment variable configuration if not already covered by existing unit tests.
3. Consider adding an explicit integration test for the hot-reload behavior in different environments if deemed high risk.

Trace matrix: qa.qaLocation/assessments/2.1-rulepack-loader-trace-20250829.md